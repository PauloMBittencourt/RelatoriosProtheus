@using RelatoriosProtheus.Models.Entities
@using RelatoriosProtheus.Models.ViewModels
@model RelatoriosProtheus.Models.ViewModels.RelatorioGruposViewModel
@{
    ViewData["Title"] = "Grupos e Relatórios";
    Layout = "_Layout";
}
<main class="container mt-5">
    <h2 class="mb-4">Grupos e Relatórios</h2>

    <div class="accordion" id="gruposAccordion">
        @foreach (var grupo in Model.Grupos)
        {
            var collapseId = $"collapseGrupo{grupo.GrupoId}";
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading@grupo.GrupoId">
                    <button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse" data-bs-target="#@collapseId"
                            aria-expanded="false" aria-controls="@collapseId"
                            style="color:@(grupo.Cor ?? "#000");">
                        @grupo.Nome
                    </button>
                </h2>
                <div id="@collapseId" class="accordion-collapse collapse"
                     aria-labelledby="heading@grupo.GrupoId" data-bs-parent="#gruposAccordion">
                    <div class="accordion-body">
                        @{
                            var relsDoGrupo = Model.Relatorios
                            .Where(r => r.RelatorioGrupos
                            .Any(rg => rg.GrupoId == grupo.GrupoId))
                            .ToList();
                        }
                        @if (relsDoGrupo.Any())
                        {
                            <ul class="list-group">
                                @foreach (var rel in relsDoGrupo)
                                {
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <div>
                                            <strong>@rel.Nome</strong><br />
                                            <small class="text-muted">@rel.Descricao</small>
                                        </div>
                                    </li>
                                }
                            </ul>
                        }
                        else
                        {
                            <div class="alert alert-warning mb-0">Nenhum relatório neste grupo.</div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</main>
